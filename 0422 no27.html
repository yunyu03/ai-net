<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AIæº«æš–å¥åº·ç‡Ÿé¤ŠApp</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --green: #bfe3c1;
      --beige: #fef9f4;
      --orange: #f8b26a;
      --shadow: rgba(0, 0, 0, 0.1);
      --radius: 20px;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--beige);
      margin: 0;
      padding: 0;
    }

    .page {
      display: none;
      max-width: 600px;
      margin: 30px auto;
      background: white;
      border-radius: var(--radius);
      box-shadow: 0 4px 10px var(--shadow);
      padding: 20px;
    }

    .page.active {
      display: block;
    }

    h2 {
      text-align: center;
      color: #444;
    }

    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
      color: #333;
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      margin-top: 5px;
      border-radius: var(--radius);
      border: 1px solid #ccc;
      font-size: 1em;
    }

    button {
      background-color: var(--green);
      color: #333;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #a3d3a8;
    }

    .highlight {
      background-color: var(--orange);
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: bold;
    }

    .advice-box {
      background-color: #f3faf4;
      padding: 15px;
      border-radius: var(--radius);
      box-shadow: 0 2px 6px var(--shadow);
      margin-top: 20px;
    }

    .history-box {
      margin-top: 10px;
      padding: 10px;
      background-color: #e7f0e7;
      border-radius: var(--radius);
      display: none;
    }

    .chart-box {
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <div class="page active" id="homePage">
    <h2>ğŸ€ AIå¥åº·ç‡Ÿé¤Šé¡§å•</h2>
    <p>æ­¡è¿ä½¿ç”¨æœ¬Appï¼Œè«‹ä¾ç…§ä¸‹åˆ—æ­¥é©Ÿæ“ä½œï¼š<br>1. é»é¸ã€Œé–‹å§‹ä½¿ç”¨ã€<br>2. å¡«å¯«åŸºæœ¬å¥åº·è³‡æ–™<br>3. ç²å¾—å°ˆå±¬åˆ†æå ±å‘Šèˆ‡é£²é£Ÿå»ºè­°</p>
    <button onclick="goToPage('loginPage')">é–‹å§‹ä½¿ç”¨</button>
  </div>

  <div class="page" id="loginPage">
    <h2>æœƒå“¡ç™»å…¥èˆ‡å¥åº·è³‡æ–™</h2>
    <label>å¸³è™Ÿï¼š</label>
    <input type="text" id="username" required />

    <label>æ€§åˆ¥ï¼š</label>
    <select id="gender">
      <option value="male">ç”·æ€§</option>
      <option value="female">å¥³æ€§</option>
    </select>

    <label>å¹´é½¡ï¼š</label>
    <input type="number" id="age" required />

    <label>èº«é«˜ï¼ˆcmï¼‰ï¼š</label>
    <input type="number" id="height" required />

    <label>é«”é‡ï¼ˆkgï¼‰ï¼š</label>
    <input type="number" id="weight" required />

    <label>å¥åº·ç‹€æ³ï¼š</label>
    <select id="condition">
      <option value="normal">æ­£å¸¸</option>
      <option value="diabetes">ç³–å°¿ç—…</option>
      <option value="hypertension">é«˜è¡€å£“</option>
      <option value="kidney">è…ç—…</option>
    </select>

    <label>é‹å‹•é »ç‡ï¼š</label>
    <select id="activity">
      <option value="low">ä½ï¼ˆæ¯é€±1æ¬¡ä»¥ä¸‹ï¼‰</option>
      <option value="medium">ä¸­ï¼ˆæ¯é€±2~4æ¬¡ï¼‰</option>
      <option value="high">é«˜ï¼ˆæ¯é€±5æ¬¡ä»¥ä¸Šï¼‰</option>
    </select>

    <label>ç¡çœ æ™‚é–“ï¼ˆå°æ™‚ï¼‰ï¼š</label>
    <input type="number" id="sleep" required />

    <button onclick="submitData()">é€å‡ºè³‡æ–™</button>
  </div>

  <div class="page" id="resultPage">
    <h2>ğŸ” åˆ†æçµæœ</h2>
    <div class="advice-box" id="adviceContent"></div>
    <div class="chart-box">
      <canvas id="nutritionChart"></canvas>
    </div>
    <button onclick="playAdvice()">æ’­æ”¾èªéŸ³</button>
    <button onclick="stopAdvice()">åœæ­¢æ’­æ”¾</button>
    <button onclick="toggleHistory()">é¡¯ç¤ºï¼éš±è—æ­·å²</button>
    <div class="history-box" id="historyContent"></div>
    <button onclick="goToPage('loginPage')">è¿”å›</button>
  </div>

  <script>
    let historyData = {};
    let currentVoice = null;

    function goToPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function submitData() {
      const user = document.getElementById("username").value.trim().toLowerCase();
      const gender = document.getElementById("gender").value;
      const age = parseInt(document.getElementById("age").value);
      const height = parseFloat(document.getElementById("height").value);
      const weight = parseFloat(document.getElementById("weight").value);
      const condition = document.getElementById("condition").value;
      const activity = document.getElementById("activity").value;
      const sleep = parseFloat(document.getElementById("sleep").value);
      const bmi = (weight / Math.pow(height / 100, 2)).toFixed(1);

      let advice = `<strong>BMIå€¼ï¼š</strong> ${bmi}<br><ul>`;

      if (bmi >= 25) advice += `<li><span class="highlight">BMIéé‡</span>ï¼Œæ˜“å°è‡´é«˜è¡€å£“ã€ç³–å°¿ç—…ã€å¿ƒè¡€ç®¡ç–¾ç—…ã€‚</li>`;
      else if (bmi < 18.5) advice += `<li><span class="highlight">BMIéè¼•</span>ï¼Œå¯èƒ½é€ æˆå…ç–«åŠ›ä¸‹é™èˆ‡éª¨è³ªç–é¬†ã€‚</li>`;
      else advice += `<li><span class="highlight">BMIæ­£å¸¸</span>ï¼Œè«‹æŒçºŒä¿æŒå¥åº·ç”Ÿæ´»ã€‚</li>`;

      advice += `<li><strong>é é˜²å»ºè­°ï¼š</strong>å‡è¡¡é£²é£Ÿã€è¦å¾‹é‹å‹•ã€å……è¶³ç¡çœ èˆ‡å®šæœŸæª¢æŸ¥ã€‚</li>`;

      if (condition === "diabetes") {
        advice += `
          <li>ã€ç³–å°¿ç—…å»ºè­°ã€‘ä½GIé£²é£Ÿã€æŒ‰æ™‚æœè—¥ã€ç›£æ¸¬è¡€ç³–ã€‚</li>
          <li>å»ºè­°é£Ÿè­œï¼š<br>æ—©é¤ï¼šåœ°ç“œï¼‹æ°´ç…®è›‹<br>åˆé¤ï¼šç³™ç±³é£¯ï¼‹è±†è…ï¼‹é’èœ<br>æ™šé¤ï¼šè”¬èœæ¹¯ï¼‹çƒ¤é›èƒ¸</li>
          <li>æ–™ç†æ­¥é©Ÿï¼š<br>1. å°‡åœ°ç“œè’¸ç†Ÿ15åˆ†é˜ã€‚<br>2. é›èƒ¸ä½¿ç”¨æ©„æ¬–æ²¹ç…ç†Ÿï¼Œæ­é…èƒ¡æ¤’èˆ‡é¦™è‰èª¿å‘³ã€‚</li>
        `;
      } else if (condition === "hypertension") {
        advice += `
          <li>ã€é«˜è¡€å£“å»ºè­°ã€‘ä½éˆ‰é£²é£Ÿã€é¿å…åŠ å·¥å“ã€ä¿æŒé«”é‡ã€‚</li>
          <li>å»ºè­°é£Ÿè­œï¼š<br>æ—©é¤ï¼šç‡•éº¥ç²¥ï¼‹é¦™è•‰<br>åˆé¤ï¼šè—œéº¥ï¼‹è’¸é­šï¼‹è èœ<br>æ™šé¤ï¼šåœ°ç“œï¼‹ç™½ç…®è›‹ï¼‹é’èŠ±èœ</li>
          <li>æ–™ç†æ­¥é©Ÿï¼š<br>1. è’¸é­š10åˆ†é˜ï¼ŒåŠ å…¥è–‘çµ²èˆ‡å°‘é‡é†¬æ²¹ã€‚<br>2. ç…®åœ°ç“œé£¯ä¸¦ä½ä»¥æ¸…è’¸è”¬èœã€‚</li>
        `;
      } else if (condition === "kidney") {
        advice += `
          <li>ã€è…ç—…å»ºè­°ã€‘é™åˆ¶é‰€èˆ‡ç£·æ”å–ã€æ¸›å°‘è›‹ç™½è³ªã€‚</li>
          <li>å»ºè­°é£Ÿè­œï¼š<br>æ—©é¤ï¼šç™½åå¸ï¼‹æ©„æ¬–è›‹<br>åˆé¤ï¼šç™½é£¯ï¼‹è’¸ç“œé¡<br>æ™šé¤ï¼šç±³ç²¥ï¼‹æ¸…ç‡™é’èœ</li>
          <li>æ–™ç†æ­¥é©Ÿï¼š<br>1. è’¸å—ç“œ8åˆ†é˜ï¼Œæ­é…ç™½é£¯ã€‚<br>2. ç±³ç²¥ä»¥ä½éˆ‰é«˜æ¹¯ç…®30åˆ†é˜ã€‚</li>
        `;
      } else {
        advice += `
          <li>æ•´é«”å¥åº·è‰¯å¥½ï¼Œç¶­æŒå‡è¡¡ç”Ÿæ´»å³å¯ã€‚</li>
          <li>å»ºè­°é£Ÿè­œï¼š<br>æ—©é¤ï¼šå„ªæ ¼ï¼‹å¥‡ç•°æœ<br>åˆé¤ï¼šåœ°ç“œé£¯ï¼‹è±†è…ç‚’æ™‚è”¬<br>æ™šé¤ï¼šç´«ç±³é£¯ï¼‹çƒ¤é®­é­šï¼‹é’èœ</li>
          <li>æ–™ç†æ­¥é©Ÿï¼š<br>1. é®­é­šçƒ¤10åˆ†é˜ï¼Œæ’’ä¸Šæª¸æª¬æ±ã€‚<br>2. ç´«ç±³æ³¡æ°´2å°æ™‚å¾Œè’¸ç…®ã€‚</li>
        `;
      }

      if (activity === "low") advice += `<li>å¢åŠ é‹å‹•ï¼šæ¯æ—¥å¿«èµ°30åˆ†é˜ã€‚</li>`;
      else if (activity === "high") advice += `<li>é‹å‹•å……è¶³ï¼Œè«‹æŒçºŒè£œå……æ°´åˆ†èˆ‡è›‹ç™½è³ªã€‚</li>`;

      if (sleep < 6) advice += `<li>å»ºè­°å¢åŠ ç¡çœ è‡³æ¯æ™š7~8å°æ™‚ï¼Œæ”¹å–„ä»£è¬èˆ‡ä¿®å¾©ã€‚</li>`;
      else advice += `<li>ç¡çœ å……è¶³ï¼Œæœ‰åŠ©å¥åº·ç¶­æŒã€‚</li>`;

      advice += `</ul>`;

      document.getElementById("adviceContent").innerHTML = advice;
      renderNutritionChart();
      goToPage('resultPage');

      const timestamp = new Date().toLocaleString();
      if (!historyData[user]) historyData[user] = [];
      historyData[user].unshift(`<strong>${timestamp}</strong><br>${advice}<hr>`);
      localStorage.setItem('healthHistory', JSON.stringify(historyData));
    }

    function renderNutritionChart() {
      const ctx = document.getElementById('nutritionChart');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['ç¢³æ°´åŒ–åˆç‰©', 'è›‹ç™½è³ª', 'è„‚è‚ª'],
          datasets: [{
            data: [50, 30, 20],
            backgroundColor: ['#a3d3a8', '#f8b26a', '#bfe3c1']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'ç‡Ÿé¤Šæ¯”ä¾‹å»ºè­°åœ–'
            }
          }
        }
      });
    }

    function playAdvice() {
      const text = document.getElementById("adviceContent").textContent;
      currentVoice = new SpeechSynthesisUtterance(text);
      currentVoice.lang = 'zh-TW';
      speechSynthesis.cancel();
      speechSynthesis.speak(currentVoice);
    }

    function stopAdvice() {
      speechSynthesis.cancel();
    }

    function toggleHistory() {
      const user = document.getElementById("username").value.trim().toLowerCase();
      const box = document.getElementById("historyContent");
      const stored = JSON.parse(localStorage.getItem('healthHistory'));
      historyData = stored || {};
      box.innerHTML = historyData[user]?.join('') || 'å°šç„¡æ­·å²ç´€éŒ„';
      box.style.display = box.style.display === 'none' ? 'block' : 'none';
    }

    window.onload = () => {
      const stored = localStorage.getItem('healthHistory');
      if (stored) historyData = JSON.parse(stored);
    }
  </script>

</body>
</html>